# Flowdock integration guide

* [Getting started](#/getting-started)
* [What does a great integration look like?](#/a-great-integration)
* [The components of an integration message](#/components-of-a-message)
* [Authentication](#/authentication)
* [Publishing your integration](#/publishing-your-integration)
* [An example integration app: Polldock](#/an-example-integration-app)

<div id="/getting-started"></div>
## Getting started

![A support ticket from Zendesk](/images/lifespan-of-a-support-ticket.png)

<small>*An example of a full-fledged Flowdock integration. You can discuss Zendesk customer support tickets and even perform basic functions (such as assigning or closing tickets) without leaving Flowdock.*</small>

To start testing the API, [create a developer application](https://www.flowdock.com/oauth/applications) and generate a flow token for it. To get the flow token, you can use the Source generation tool that is available on the application page under Tools section.

Once you have everything set up, let's try sending a simple request. You can either use the curl command that was generated by the script above or use the snippet below by replacing the token and flow name with ones generated in the previous step.

```
> curl -i -X POST -H "Content-Type: application/json" -d '{
"flow_token": "be299b91fffe8e4124986b9b5b44dfc6",
  "event": "activity",
  "author": {
    "name": "Marty",
    "avatar": "https://avatars.githubusercontent.com/u/3017123?v=3"
  },
  "title": "updated ticket",
  "external_thread_id": "1234567",
  "thread": {
    "title": "Polish the flux capacitor",
    "fields": [{ "label": "Dustiness", "value": "5 - severe" }],
    "body": "The flux capacitor has been in storage for more than 30 years and it needs to be spick and span for the re-launch.",
    "external_url": "https://example.com/projects/bttf/tickets/1234567",
    "status": {
      "color": "green",
      "value": "open"
    }
  }
}' https://api.flowdock.com/messages
```

This posts a [message](messages) to the Flowdock API. Since it includes [thread](threads) data, a new thread is created and the message is posted in the context of that thread.

![The message posted above](/images/example-message-polish-the-flux-capacitor.png)

In this example, the message describes an [activity](message-types#/activity) that took place in the third party service – a new ticket was created. The included thread data contains the current state (name, description, etc.) of the newly created ticket.

This brings up an important point when designing your integration: each message is related to some item in the third party service. What the item is depends on the service. With customer support systems, the item is most likely a support ticket. With version control, it can be a commit or pull request. Messages that are related to that one item are grouped together as a thread in Flowdock, and the contents of the `thread` parameter should contain the latest state of the item.

In other words, **an item in the third party service is the same as a thread in Flowdock**.

To post another message to the same thread, simply post another message with the same `external_thread_id`. It's a good principle to map these external IDs to the IDs of the items in your app. For example, GitHub uses issue or pull request numbers and Zendesk uses ticket IDs. They only need to be unique in the context of the source (e.g. project or repository).

We can update the status of the ticket by changing the values in the status field and POSTing the above again.

```
    "status": {
      "color": "grey",
      "value": "closed"
    }
```

The item will update in real-time along with a message saying that the ticket was updated.

![The update that just happened](/images/update-happened.png)

<div id="/a-great-integration"></div>
## What does a great integration look like?

The best Flowdock integrations are with other work-related web apps. These third party apps send activity updates to Flowdock. A great integration with a project management tool will send updates when items are created, updated or commented on.

For example, our Zendesk integration sends updates to Flowdock whenever a new customer support ticket is created, someone replies to a ticket or updates its status. Each new update can include both a message ("ticket was updated") and a new updated state for the ticket.

<div id="/components-of-a-message"></div>
## The components of an integration message

![A support ticket from Zendesk with legend](/images/lifespan-of-a-support-ticket-legend.png)

When presenting your app's items in Flowdock as a thread, you can use these great features:

1. **Title** - Simple enough, this should be the name of the item in your app. For Zendesk, this is the subject line of the support ticket.
1. **Icon** - Each integration has its own icon. You can configure this from the [Developer applications](https://www.flowdock.com/oauth/applications) page.
1. **Fields** - All the simple properties – in other words, a list of key-value pairs. The Zendesk integration uses these to show the To, From and other fields of the support ticket. Project management tools send all the properties of a specific issue/ticket/story.
1. **Body** - This generally contains the most important content of the item, like an issue description. In some cases, this is not needed, such as when new replies and updates make up the most interesting content in Zendesk.
1. **Status** - A great way to highlight progress. It gives a quick and visible answer to questions like "Has this pull request been merged?", "What's the status of our server?" or "Has this support ticket been resolved?". The status is shown visibly in the [team inbox](/help/team_inbox). You can even color-code the different states (e.g. blocked = red, solved = green).
1. **[Actions](thread-actions)** - An amazing tool for [making the integration bidirectional](how-to-create-bidirectional-integrations). You can define actions to allow users to complete tasks directly from Flowdock. Examples include "Assign to me", "Mark as solved", "Try to build this again" and "Merge pull request".

For detailed descriptions of these fields, check out the [threads documentation](threads).

When posting messages into threads, there are a generally two types of messages that should be used: [activities](message-types#/activity) or [discussions](message-types#/discussion). To control which kind of a message is being sent, set the *event* field as "activity" or "discussion".

#### Activities

[Activity messages](message-types#/activity) should be used when an item in your app gets created, updated or deleted.

![An activity message](/images/activity-message.png)

The *title* should follow the format "Marty McFly **did something**". In other words, examples of a good title are "updated ticket" or "merged pull request".

#### Discussions

If the update is related to a discussion or comment in your app, you should send a [discussion](message-types#/discussion) message.

![A discussion message](/images/discussion-message.png)

A discussion message's most important field is *body*. You can also set the *title* similarly as with activity messages ("said" or "commented" are good candidates).

<div id="/authentication"></div>
## Authentication

Flowdock uses OAuth 2.0 for authentication. There are dozens of libraries available that remove the pain of implementing OAuth for your app.

For a simple example, take a look at [this script that handles authentication for testing purposes](https://github.com/flowdock/flowdock-example-integration/blob/master/flowdock-oauth.rb).

For a closer look at Flowdock's authentication, you can read our [authentication documentation](authentication).

<div id="/publishing-your-integration"></div>
## Publishing your integration

Once your integration is ready for general use, make sure you've [configured your app correctly](https://www.flowdock.com/oauth/applications) (including an appropriate icon) and send an e-mail to support@flowdock.com. After reviewing it, we'll publish it and add it to our [integrations list](/integrations). We'll also be sure to mention it in our monthly newsletter.

<div id="/an-example-integration-app"></div>
## An example integration app: Polldock

![Polldock in its own browser window and in Flowdock](/images/polldock-screenshot.png)

We've written an example polling app that updates Flowdock with new polls and votes, has a discussion integration, and even allows users to vote directly from Flowdock. The source code is [available on GitHub](https://github.com/flowdock/flowdock-example-integration). You can use it as an example for building your own integration.
